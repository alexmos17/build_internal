[
  {
    "cmd": [
      "python",
      "-u",
      "[DEPOT_TOOLS_ROOT]/gclient.py",
      "config",
      "--spec",
      "cache_dir = None\nsolutions = [{'deps_file': '.DEPS.git', 'managed': True, 'name': 'src/repo', 'url': 'svn://svn.chromium.org/chrome/trunk/src'}]\ntarget_os = ['android']"
    ],
    "name": "gclient setup",
    "seed_steps": [
      "gclient setup",
      "gclient revert",
      "gclient sync"
    ]
  },
  {
    "cmd": [
      "python",
      "-u",
      "[BUILD_ROOT]/scripts/slave/gclient_safe_revert.py",
      ".",
      "[DEPOT_TOOLS_ROOT]/gclient"
    ],
    "name": "gclient revert"
  },
  {
    "cmd": [
      "python",
      "-u",
      "[DEPOT_TOOLS_ROOT]/gclient.py",
      "sync",
      "--nohooks",
      "--revision",
      "src/repo@4f4b02f6b7fa20a3a25682c457bbc8ad589c8a00"
    ],
    "name": "gclient sync"
  },
  {
    "cmd": [
      "[SLAVE_BUILD_ROOT]/src/repo/build/dump_app_manifest_vars.py",
      "-b",
      "builder_name",
      "-v",
      "[SLAVE_BUILD_ROOT]/src/chrome/VERSION",
      "--output-json",
      "/path/to/tmp/json"
    ],
    "name": "get app_manifest_vars",
    "~followup_annotations": [
      "@@@STEP_LOG_LINE@json.output@{@@@",
      "@@@STEP_LOG_LINE@json.output@  \"build_id\": 3333, @@@",
      "@@@STEP_LOG_LINE@json.output@  \"date_string\": 6001, @@@",
      "@@@STEP_LOG_LINE@json.output@  \"version_code\": 10, @@@",
      "@@@STEP_LOG_LINE@json.output@  \"version_name\": \"some_builder_1234\"@@@",
      "@@@STEP_LOG_LINE@json.output@}@@@",
      "@@@STEP_LOG_END@json.output@@@"
    ]
  },
  {
    "cmd": [
      "[SLAVE_BUILD_ROOT]/src/build/env_dump.py",
      "--output-json",
      "/path/to/tmp/json",
      "[SLAVE_BUILD_ROOT]/src/build/android/envsetup.sh"
    ],
    "env": {
      "ANDROID_SDK_BUILD_TOOLS_VERSION": "android-KeyLimePie",
      "ANDROID_SDK_ROOT": "[SLAVE_BUILD_ROOT]/src/third_party/android_tools_internal/sdk",
      "ANDROID_SDK_VERSION": "KeyLimePie",
      "PATH": "[BUILD_INTERNAL_ROOT]/scripts/slave/android::%(PATH)s"
    },
    "name": "envsetup",
    "~followup_annotations": [
      "@@@STEP_LOG_LINE@json.output@{@@@",
      "@@@STEP_LOG_LINE@json.output@  \"GYP_DEFINES\": \"my_new_gyp_def=aaa\", @@@",
      "@@@STEP_LOG_LINE@json.output@  \"GYP_SOMETHING\": \"gyp_something_value\", @@@",
      "@@@STEP_LOG_LINE@json.output@  \"PATH\": \"./\"@@@",
      "@@@STEP_LOG_LINE@json.output@}@@@",
      "@@@STEP_LOG_END@json.output@@@"
    ]
  },
  {
    "cmd": [
      "python",
      "-u",
      "\nimport shutil, sys, os\nshutil.rmtree(sys.argv[1], True)\nshutil.rmtree(sys.argv[2], True)\nfor base, _dirs, files in os.walk(sys.argv[3]):\n  for f in files:\n    if f.endswith('.pyc'):\n      os.remove(os.path.join(base, f))\n",
      "[SLAVE_BUILD_ROOT]/src/out/Debug/debug_info_dumps",
      "[SLAVE_BUILD_ROOT]/src/out/Debug/test_logs",
      "[SLAVE_BUILD_ROOT]/src"
    ],
    "name": "clean local files",
    "~followup_annotations": [
      "@@@STEP_LOG_LINE@python.inline@@@@",
      "@@@STEP_LOG_LINE@python.inline@import shutil, sys, os@@@",
      "@@@STEP_LOG_LINE@python.inline@shutil.rmtree(sys.argv[1], True)@@@",
      "@@@STEP_LOG_LINE@python.inline@shutil.rmtree(sys.argv[2], True)@@@",
      "@@@STEP_LOG_LINE@python.inline@for base, _dirs, files in os.walk(sys.argv[3]):@@@",
      "@@@STEP_LOG_LINE@python.inline@  for f in files:@@@",
      "@@@STEP_LOG_LINE@python.inline@    if f.endswith('.pyc'):@@@",
      "@@@STEP_LOG_LINE@python.inline@      os.remove(os.path.join(base, f))@@@",
      "@@@STEP_LOG_END@python.inline@@@"
    ]
  },
  {
    "allow_subannottations": true,
    "cmd": [
      "[SLAVE_BUILD_ROOT]/src/build/tree_truth.sh",
      "[SLAVE_BUILD_ROOT]/src",
      "src",
      "src-internal",
      "src/repo"
    ],
    "name": "tree truth steps"
  },
  {
    "cmd": [
      "python",
      "-u",
      "[DEPOT_TOOLS_ROOT]/gclient.py",
      "runhooks"
    ],
    "env": {
      "ANDROID_SDK_BUILD_TOOLS_VERSION": "android-KeyLimePie",
      "ANDROID_SDK_ROOT": "[SLAVE_BUILD_ROOT]/src/third_party/android_tools_internal/sdk",
      "ANDROID_SDK_VERSION": "KeyLimePie",
      "EXTRA_LANDMINES_SCRIPT": "[SLAVE_BUILD_ROOT]/src/repo/build/get_internal_landmines.py",
      "GYP_CROSSCOMPILE": "1",
      "GYP_DEFINES": "OS=android app_manifest_version_code=10 app_manifest_version_name=some_builder_1234 chrome_build_id=3333 component=shared_library fastbuild=1 gcc_version=46 host_os=linux order_text_section=[SLAVE_BUILD_ROOT]/src/orderfiles/orderfile.out target_arch=arm",
      "GYP_GENERATORS": "ninja",
      "GYP_GENERATOR_FLAGS": "default_target=All",
      "PATH": "[BUILD_INTERNAL_ROOT]/scripts/slave/android:./:%(PATH)s"
    },
    "name": "gclient runhooks"
  },
  {
    "cmd": [
      "python",
      "-u",
      "[BUILD_ROOT]/scripts/slave/compile.py",
      "--target",
      "Debug",
      "--build-dir",
      "[SLAVE_BUILD_ROOT]/src/out",
      "--src-dir",
      "[SLAVE_BUILD_ROOT]/src",
      "--build-tool",
      "ninja",
      "--compiler",
      "goma",
      "--",
      "All"
    ],
    "env": {
      "ANDROID_SDK_BUILD_TOOLS_VERSION": "android-KeyLimePie",
      "ANDROID_SDK_ROOT": "[SLAVE_BUILD_ROOT]/src/third_party/android_tools_internal/sdk",
      "ANDROID_SDK_VERSION": "KeyLimePie",
      "PATH": "[BUILD_INTERNAL_ROOT]/scripts/slave/android:./:%(PATH)s"
    },
    "name": "compile"
  }
]